{%  load static %}
{% load humanize %}

<!doctype html>

<html
  lang="en"
  class="layout-navbar-fixed layout-menu-fixed layout-compact"
  dir="ltr"
  data-skin="default"
  data-bs-theme="light"
  data-assets-path="{% static 'assets' %}">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
     <title>Growfox - Marketing Data Center</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'assets/img/favicon/gavicon.jpg' %}?v=3" />


    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&ampdisplay=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="{% static 'assets/vendor/fonts/iconify-icons.css' %}" />

    <!-- Core CSS -->
    <!-- build:css assets/vendor/css/theme.css -->

    <link rel="stylesheet" href="{% static 'assets/vendor/libs/node-waves/node-waves.css' %}" />

    <link rel="stylesheet" href="{% static 'assets/vendor/libs/pickr/pickr-themes.css' %}" />

    <link rel="stylesheet" href="{% static 'assets/vendor/css/core.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/demo.css' %}" />

    <!-- Vendors CSS -->

    <link rel="stylesheet" href="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css' %}" />

    <!-- endbuild -->

    <link rel="stylesheet" href="{% static 'assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/apex-charts/apex-charts.css' %}" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="{% static 'assets/vendor/js/helpers.js' %}"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->

    <!--? Template customizer: To hide customizer set displayCustomizer value false in config.js. -->
    <script src="{% static 'assets/vendor/js/template-customizer.js' %}"></script>

    <!--? Config: Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file. -->

    <script src="{% static 'assets/js/config.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.0/dist/chartjs-adapter-luxon.min.js"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->
<aside id="layout-menu" class="layout-menu menu-vertical menu">
  <div class="app-brand demo logo-wrapper">
    <!-- ‚úÖ ‡πÅ‡∏Å‡πâ href ‡∏à‡∏≤‡∏Å index.html ‡πÄ‡∏õ‡πá‡∏ô {% url 'index' %} -->
    <a href="{% url 'index' %}" class="app-brand-link">
      <img src="{% static 'assets/img/branding/growfox.webp' %}" alt="Growfox Logo" class="logo-img" />
      <img src="{% static 'assets/img/favicon/gavicon.jpg' %}" alt="Fox Icon" class="logo-img logo-icon d-none" />
    </a>

    <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-white text-large ms-auto">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M8.47365 11.7183C8.11707 12.0749 8.11707 12.6531 8.47365 13.0097L12.071 16.607C12.4615 16.9975 12.4615 17.6305 12.071 18.021C11.6805 18.4115 11.0475 18.4115 10.657 18.021L5.83009 13.1941C5.37164 12.7356 5.37164 11.9924 5.83009 11.5339L10.657 6.707C11.0475 6.31653 11.6805 6.31653 12.071 6.707C12.4615 7.09747 12.4615 7.73053 12.071 8.121L8.47365 11.7183Z"
          fill-opacity="0.9" />
        <path
          d="M14.3584 11.8336C14.0654 12.1266 14.0654 12.6014 14.3584 12.8944L18.071 16.607C18.4615 16.9975 18.4615 17.6305 18.071 18.021C17.6805 18.4115 17.0475 18.4115 16.657 18.021L11.6819 13.0459C11.3053 12.6693 11.3053 12.0587 11.6819 11.6821L16.657 6.707C17.0475 6.31653 17.6805 6.31653 18.071 6.707C18.4615 7.09747 18.4615 7.73053 18.071 8.121L14.3584 11.8336Z"
          fill-opacity="0.4" />
      </svg>
    </a>
  </div>

  <div class="menu-inner-shadow"></div>

  <ul class="menu-inner py-1">


            <!-- Add Group Menu Bar -->
            <li class="menu-header small mt-5">
              <span class="menu-header-text" data-i18n="Apps & Pages">Pages &amp; Posts</span>
            </li>
<li class="menu-item active open">
  <a href="javascript:void(0);" class="menu-link menu-toggle">
    <i class="menu-icon icon-base ri ri-numbers-line"></i>
    <div data-i18n="Page Campaigns">Page Campaigns</div>
    <div class="badge badge-center text-bg-danger rounded-pill ms-auto">{{ page_groups_count }}</div>
  </a>
  <ul class="menu-sub">
    {% for group in page_groups_sidebar %}
      <li class="menu-item">
        <a href="{% url 'group_detail' group.id %}" class="menu-link">
          <div data-i18n="{{ group.group_name }}">{{ group.group_name }}</div>
        </a>
      </li>
    {% endfor %}
  </ul>
</li>
<!-- üî∂ Post Campaign Menu -->
<li class="menu-item open">
  <a href="javascript:void(0);" class="menu-link menu-toggle">
    <i class="menu-icon icon-base ri ri-article-line"></i>
    <div data-i18n="Post Campaigns">Post Campaigns</div>
    <div class="badge badge-center text-bg-danger rounded-pill ms-auto">{{ comment_campaign_groups|length }}</div>
  </a>
  <ul class="menu-sub">
    {% for group in comment_campaign_groups %}
      <li class="menu-item">
        <!-- ‡πÉ‡∏ä‡πâ campaign_group.group_name ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏Ñ‡∏°‡πÄ‡∏õ‡∏ç -->
        <a href="{% url 'posts_campaign' group_name=group.group_name %}" class="menu-link">
          <div>{{ group.group_name }}</div> <!-- ‡πÉ‡∏ä‡πâ group_name ‡πÅ‡∏ó‡∏ô campaign_name -->
        </a>
      </li>
    {% endfor %}
  </ul>
</li>

  <!-- ‚öôÔ∏è Setting & User moved to bottom -->
  <div class="mt-auto">
    <ul class="menu-inner py-1">
      <li class="menu-header small mt-5">
        <span class="menu-header-text">Setting</span>
      </li>
      <li class="menu-item">
        <a href="javascript:void(0);" class="menu-link menu-toggle">
          <i class="menu-icon ri ri-user-line"></i>
          <div data-i18n="Users">Users</div>
        </a>
        <ul class="menu-sub">
          <li class="menu-item">
            <a href="app-ecommerce-dashboard.html" class="menu-link">
              <div data-i18n="hello@growfox.co">hello@growfox.co</div>
            </a>
          </li>
        </ul>
      </li>
      <li class="menu-item">
        <a href="javascript:void(0);" class="menu-link menu-toggle">
          <i class="menu-icon ri ri-settings-3-line"></i>
          <div data-i18n="Setting">Setting</div>
        </a>
      </li>
    </ul>
  </div>
</aside>

        <div class="menu-mobile-toggler d-xl-none rounded-1">
          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large text-bg-secondary p-2 rounded-1">
            <i class="ri ri-menu-line icon-base"></i>
            <i class="ri ri-arrow-right-s-line icon-base"></i>
          </a>
        </div>
          <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <nav
            class="layout-navbar container-xxl navbar-detached navbar navbar-expand-xl align-items-center bg-navbar-theme"
            id="layout-navbar">
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
                <i class="icon-base ri ri-menu-line icon-22px"></i>
              </a>
            </div>

            <div class="navbar-nav-right d-flex align-items-center justify-content-end" id="navbar-collapse">
              <!-- Search -->
              <div class="navbar-nav align-items-center">
                <div class="nav-item navbar-search-wrapper mb-0">
                  <a class="nav-item nav-link search-toggler px-0" href="javascript:void(0);">
                    <span class="d-inline-block text-body-secondary fw-normal" id="autocomplete"></span>
                  </a>
                </div>
              </div>

              <!-- /Search -->

              <ul class="navbar-nav flex-row align-items-center ms-md-auto"
                <li class="nav-item dropdown me-sm-2 me-xl-0">
                  <a
                    class="nav-link dropdown-toggle hide-arrow btn btn-icon btn-text-secondary rounded-pill"
                    id="nav-theme"
                    href="javascript:void(0);"
                    data-bs-toggle="dropdown">
                    <i class="icon-base ri ri-sun-line icon-22px theme-icon-active"></i>
                    <span class="d-none ms-2" id="nav-theme-text">Toggle theme</span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-theme-text">
                    <li>
                      <button
                        type="button"
                        class="dropdown-item align-items-center active"
                        data-bs-theme-value="light"
                        aria-pressed="false">
                        <span><i class="icon-base ri ri-sun-line icon-22px me-3" data-icon="sun-line"></i>Light</span>
                      </button>
                    </li>
                    <li>
                      <button
                        type="button"
                        class="dropdown-item align-items-center"
                        data-bs-theme-value="dark"
                        aria-pressed="true">
                        <span
                          ><i class="icon-base ri ri-moon-clear-line icon-22px me-3" data-icon="moon-clear-line"></i
                          >Dark</span
                        >
                      </button>
                    </li>
                    <li>
                      <button
                        type="button"
                        class="dropdown-item align-items-center"
                        data-bs-theme-value="system"
                        aria-pressed="false">
                        <span
                          ><i class="icon-base ri ri-computer-line icon-22px me-3" data-icon="computer-line"></i
                          >System</span
                        >
                      </button>
                    </li>
                  </ul>
                </li>
                <!-- / Style Switcher-->

                <!-- Notification -->
                <li class="nav-item dropdown-notifications navbar-dropdown dropdown me-4 me-xl-1">
                  <a
                    class="nav-link dropdown-toggle hide-arrow btn btn-icon btn-text-secondary rounded-pill"
                    href="javascript:void(0);"
                    data-bs-toggle="dropdown"
                    data-bs-auto-close="outside"
                    aria-expanded="false">
                    <i class="icon-base ri ri-notification-2-line icon-22px"></i>
                    <span
                      class="position-absolute top-0 start-50 translate-middle-y badge badge-dot bg-danger mt-2 border"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end py-0">
                    <li class="dropdown-menu-header border-bottom py-50">
                      <div class="dropdown-header d-flex align-items-center py-2">
                        <h6 class="mb-0 me-auto">Notification</h6>
                        <div class="d-flex align-items-center h6 mb-0">
                          <span class="badge rounded-pill bg-label-primary fs-xsmall me-2">8 New</span>
                          <a
                            href="javascript:void(0)"
                            class="dropdown-notifications-all p-2"
                            data-bs-toggle="tooltip"
                            data-bs-placement="top"
                            title="Mark all as read"
                            ><i class="icon-base ri ri-mail-open-line text-heading"></i
                          ></a>
                        </div>
                      </div>
                    </li>
                    <li class="dropdown-notifications-list scrollable-container">
                      <ul class="list-group list-group-flush">
                        <li class="list-group-item list-group-item-action dropdown-notifications-item">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <img src="../../assets/img/avatars/1.png" alt="avatar" class="rounded-circle" />
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">Congratulation Lettie üéâ</h6>
                              <small class="mb-1 d-block text-body">Won the monthly best seller gold badge</small>
                              <small class="text-body-secondary">1h ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                        <li class="list-group-item list-group-item-action dropdown-notifications-item">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <span class="avatar-initial rounded-circle bg-label-danger">CF</span>
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">Charles Franklin</h6>
                              <small class="mb-1 d-block text-body">Accepted your connection</small>
                              <small class="text-body-secondary">12hr ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                        <li class="list-group-item list-group-item-action dropdown-notifications-item marked-as-read">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <img src="../../assets/img/avatars/2.png" alt="avatar" class="rounded-circle" />
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">New Message ‚úâÔ∏è</h6>
                              <small class="mb-1 d-block text-body">You have new message from Natalie</small>
                              <small class="text-body-secondary">1h ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                        <li class="list-group-item list-group-item-action dropdown-notifications-item">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <span class="avatar-initial rounded-circle bg-label-success"
                                  ><i class="icon-base ri ri-shopping-cart-2-line icon-18px"></i
                                ></span>
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">Whoo! You have new order üõí</h6>
                              <small class="mb-1 d-block text-body">ACME Inc. made new order $1,154</small>
                              <small class="text-body-secondary">1 day ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                        <li class="list-group-item list-group-item-action dropdown-notifications-item marked-as-read">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <img src="../../assets/img/avatars/9.png" alt="avatar" class="rounded-circle" />
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">Application has been approved üöÄ</h6>
                              <small class="mb-1 d-block text-body"
                                >Your ABC project application has been approved.</small
                              >
                              <small class="text-body-secondary">2 days ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                        <li class="list-group-item list-group-item-action dropdown-notifications-item marked-as-read">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <span class="avatar-initial rounded-circle bg-label-success"
                                  ><i class="icon-base ri ri-pie-chart-2-line icon-18px"></i
                                ></span>
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">Monthly report is generated</h6>
                              <small class="mb-1 d-block text-body">July monthly financial report is generated </small>
                              <small class="text-body-secondary">3 days ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                        <li class="list-group-item list-group-item-action dropdown-notifications-item marked-as-read">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <img src="../../assets/img/avatars/5.png" alt="avatar" class="rounded-circle" />
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">Send connection request</h6>
                              <small class="mb-1 d-block text-body">Peter sent you connection request</small>
                              <small class="text-body-secondary">4 days ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                        <li class="list-group-item list-group-item-action dropdown-notifications-item">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <img src="../../assets/img/avatars/6.png" alt="avatar" class="rounded-circle" />
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">New message from Jane</h6>
                              <small class="mb-1 d-block text-body">Your have new message from Jane</small>
                              <small class="text-body-secondary">5 days ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                        <li class="list-group-item list-group-item-action dropdown-notifications-item marked-as-read">
                          <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                              <div class="avatar">
                                <span class="avatar-initial rounded-circle bg-label-warning"
                                  ><i class="icon-base ri ri-error-warning-line icon-18px"></i
                                ></span>
                              </div>
                            </div>
                            <div class="flex-grow-1">
                              <h6 class="small mb-1">CPU is running high</h6>
                              <small class="mb-1 d-block text-body"
                                >CPU Utilization Percent is currently at 88.63%,</small
                              >
                              <small class="text-body-secondary">5 days ago</small>
                            </div>
                            <div class="flex-shrink-0 dropdown-notifications-actions">
                              <a href="javascript:void(0)" class="dropdown-notifications-read"
                                ><span class="badge badge-dot"></span
                              ></a>
                              <a href="javascript:void(0)" class="dropdown-notifications-archive"
                                ><span class="icon-base ri ri-close-line"></span
                              ></a>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </li>
                    <li class="border-top">
                      <div class="d-grid p-4">
                        <a class="btn btn-primary btn-sm d-flex" href="javascript:void(0);">
                          <small class="align-middle">View all notifications</small>
                        </a>
                      </div>
                    </li>
                  </ul>
                </li>
                <!--/ Notification -->

                            <!-- User -->
                    <li class="nav-item navbar-dropdown dropdown-user dropdown">
                  <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                    <div class="avatar avatar-online">
<img src="{% static 'assets/img/avatars/Fox.webp' %}" alt="avatar" class="rounded-circle" />
                    </div>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end mt-3 py-2">
                    <li>
                      <a class="dropdown-item" href="pages-account-settings-account.html">
                        <div class="d-flex align-items-center">
                          <div class="flex-shrink-0 me-2">
                            <div class="avatar avatar-online">
<img src="{% static 'assets/img/avatars/Fox.webp' %}" alt="avatar" class="rounded-circle" />
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-0 small">Hello Growfox</h6>
                            <small class="text-body-secondary">Maythas</small>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="pages-profile-user.html">
                        <i class="icon-base ri ri-user-3-line icon-22px me-3"></i
                        ><span class="align-middle">My Profile</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="pages-account-settings-account.html">
                        <i class="icon-base ri ri-settings-4-line icon-22px me-3"></i
                        ><span class="align-middle">Settings</span>
                      </a>
                    </li>
                    <li>
                      <div class="d-grid px-4 pt-2 pb-1">
                        <a class="btn btn-sm btn-danger d-flex" href="auth-login-cover.html" target="_blank">
                          <small class="align-middle">Logout</small>
                          <i class="icon-base ri ri-logout-box-r-line ms-2 icon-16px"></i>
                        </a>
                      </div>
                    </li>
                  </ul>
                </li>
                <!--/ User -->
              </ul>
            </div>
          </nav>

          <!-- / Navbar -->

          <!-- / Navbar -->
<!-- Content wrapper -->
<div class="content-wrapper">
  <div class="container-xxl flex-grow-1 container-p-y">
    <!-- üî∏ ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏° + ‡∏õ‡∏∏‡πà‡∏° Add Page -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">{{ group.group_name }}</h3>
      <form method="POST" action="{% url 'add_page' group.id %}">
        {% csrf_token %}
        <div class="d-flex">
          {{ form.url }} <!-- ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô input url ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô hidden ‡πÑ‡∏î‡πâ -->
          <button type="submit" class="btn text-white fw-semibold" style="
            background-color: #ff6f00;  /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡πÅ‡∏ö‡∏ö‡∏õ‡∏∏‡πà‡∏° Add Group For Page */
            border: none;
            border-radius: 8px;
            padding: 8px 16px;">
            Add Page
          </button>
        </div>
      </form>
    </div>

    <!-- üîπ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á All Page Metric Overview (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß) -->
    {% if pages %}
    <div class="card shadow-sm rounded mb-4 w-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">All Page Metric Overview</h5>
        <input type="text" placeholder="Search Page" class="form-control w-25">
      </div>
      <div class="table-responsive">
  <table class="table table-striped align-middle text-center">
    <thead class="table-light">
      <tr>
        <th scope="col">Page</th>
        <th scope="col">Followers</th>

        {% if pages|length > 0 and pages.0.platform == "youtube" %}
          <th scope="col">Viewers</th>
          <th scope="col">All Video</th>
        {% else %}
          <th scope="col">Likes</th>
          <th scope="col">Talking</th>
        {% endif %}

        <th scope="col">Website</th>
        <th scope="col">Email</th>
        <th scope="col">Phone</th>
      </tr>
    </thead>

<tbody>
{% for page in pages %}
<tr>
  <td class="d-flex align-items-center">
    <img src="{{ page.profile_pic }}" alt="{{ page.page_name|default:page.page_username }}" width="40" height="40" class="rounded-circle me-2">
    <div class="text-start">
      <a href="{% url 'pageview' page.id %}" class="fw-semibold">
        {{ page.page_name|default:page.page_username }}
      </a>
      <br>
      <a href="{{ page.page_url }}" target="_blank" class="small text-muted">View Page</a>
    </div>
  </td>

  <!-- Followers -->
  <td class="hover-count">
    <span class="short">{{ page.page_followers|intcomma|default:"-" }}</span>
    <span class="full">{{ page.page_followers_count|intcomma|default:"-" }}</span>
  </td>

  <!-- Likes ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ -->
  <td class="hover-count">
    <span class="short">
      {% if page.platform == "lemon8" %}
        {{ page.page_likes|default:"-" }}
      {% else %}
        {{ page.page_likes|intcomma|default:"-" }}
      {% endif %}
    </span>
    <span class="full">
      {% if page.platform == "lemon8" %}
        {{ page.page_likes|default:"-" }}
      {% else %}
        {{ page.page_likes_count|intcomma|default:"-" }}
      {% endif %}
    </span>
  </td>

  <style>
  .hover-count .full {
    display: none;
    background-color: black;
    color: white;
    padding: 2px 5px;
    border-radius: 4px;
  }
  .hover-count:hover .short {
    display: none;
  }
  .hover-count:hover .full {
    display: inline;
  }
  </style>

  <!-- Talking, Website, Email, Phone -->
  {% if page.platform == "facebook" %}
    <td>{{ page.page_talking_count|default:"0" }}</td>
    <td><a href="{{ page.page_website }}" target="_blank">{{ page.page_website|default:"-" }}</a></td>
    <td><a href="mailto:{{ page.page_email }}">{{ page.page_email|default:"-" }}</a></td>
    <td>{{ page.page_phone|default:"-" }}</td>
  {% elif page.platform == "instagram" %}
    <td>-</td>
    <td><a href="{{ page.page_website }}" target="_blank">{{ page.page_website|default:"-" }}</a></td>
    <td>-</td>
    <td>-</td>
  {% elif page.platform == "lemon8" %}
    <td>-</td>
    <td><a href="{{ page.page_website }}" target="_blank">{{ page.page_website|default:"-" }}</a></td>
    <td>-</td>
    <td>-</td>
{% elif page.platform == "youtube" %}
  <td>{{ page.page_videos_count|default:"-" }}</td>
  <td><a href="{{ page.page_website }}" target="_blank">{{ page.page_website|default:"-" }}</a></td>
  <td>-</td>
  <td>-</td>
{% else %}
  <td>-</td>
  <td>-</td>
  <td>-</td>
  <td>-</td>
{% endif %}</tr>
{% endfor %}
</tbody>
        </table>
      </div>
    </div>
    {% else %}
    <p class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏à‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ</p>
    {% endif %}
  </div>
</div>

  <!-- üßä Grid Row ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≠‡∏á‡∏Å‡∏£‡∏≤‡∏ü -->
  <!-- ‚úÖ Layout: 2 ‡πÅ‡∏ñ‡∏ß ‡πÅ‡∏ñ‡∏ß‡∏•‡∏∞ 2 ‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 460px) -->
<div class="row">
  <!-- üî¥ Profiles with the most followers -->
  <div class="col-md-6 d-flex">
    <div class="card shadow-sm border-0 p-4 w-100" style="height: 460px;">
      <h6 class="mb-3 fw-semibold">Profiles with the most followers</h6>
      <div class="position-relative" style="width: 100%; height: 360px;">
        <canvas id="followersBarChart"></canvas>
        <div id="chartOverlays" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2;"></div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="followersPostsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content rounded">
      <div class="modal-header">
        <h5 class="modal-title fw-semibold">Posts by Selected Page</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="followersPostsModalBody"></div>
    </div>
  </div>
</div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ‚úÖ Custom Tooltip Style -->
  <style>
    canvas#followersBarChart {
      z-index: 1;
      position: relative;
    }

    #external-tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 8px 12px;
      font-size: 13px;
      font-family: 'Inter';
      border-radius: 6px;
      pointer-events: none;
      z-index: 9999;
      white-space: nowrap;
    }
  </style>

<script>
const chartData = JSON.parse(`{{ chart_data_json|safe }}`);
const labels = chartData.map(p => p.name);
const data = chartData.map(p => p.followers);
const colors = chartData.map(p => p.color);

const ctx = document.getElementById('followersBarChart').getContext('2d');

const followersChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      data: data,
      backgroundColor: colors,
      borderRadius: 6,
      barThickness: 20
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    layout: {
      padding: { top: 20 }
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        enabled: false,
        external: function (context) {
          let tooltipEl = document.getElementById('external-tooltip');
          if (!tooltipEl) {
            tooltipEl = document.createElement('div');
            tooltipEl.id = 'external-tooltip';
            document.body.appendChild(tooltipEl);
          }

          const tooltipModel = context.tooltip;
          if (tooltipModel.opacity === 0) {
            tooltipEl.style.opacity = 0;
            return;
          }

          const point = tooltipModel.dataPoints[0];
          const label = point.label;
          const value = point.raw.toLocaleString() + ' followers';

          tooltipEl.innerHTML = `<strong>${label}</strong><br>${value}`;
          tooltipEl.style.opacity = 1;

          const canvasRect = context.chart.canvas.getBoundingClientRect();
          tooltipEl.style.left = canvasRect.left + window.scrollX + tooltipModel.caretX + 'px';
          tooltipEl.style.top = canvasRect.top + window.scrollY + tooltipModel.caretY - 70 + 'px';
        }
      }
    },
    onClick: function (evt, elements) {
      if (elements.length > 0) {
        const index = elements[0].index;
        const page = chartData[index];
        const postsMap = JSON.parse(`{{ followers_posts_map|escapejs }}`);
        const posts = postsMap[page.id] || [];

        const html = posts.map(p => `
          <div class="d-flex border rounded mb-2 small overflow-hidden" style="height: 90px;">
            <div style="width: 90px; height: 90px; flex-shrink: 0; overflow: hidden;">
              ${p.post_imgs?.[0] ? `<a href="https://www.facebook.com/${p.post_id}" target="_blank">
                <img src="${p.post_imgs[0]}" style="height: 100%; width: 90px; object-fit: cover;" class="rounded-start" /></a>` :
                `<div style="height: 100%; width: 90px; background-color: #f8f9fa;"></div>`}
            </div>
            <div class="flex-grow-1 px-2 py-1 d-flex flex-column justify-content-between" style="min-width: 0;">
              <div class="d-flex justify-content-between align-items-start">
                <div class="d-flex align-items-center gap-2">
                  ${p.page?.profile_pic ? `<img src="${p.page.profile_pic}" class="rounded-circle" style="width: 16px; height: 16px;">` : ''}
                  <i class="bi bi-facebook text-primary"></i>
                  <strong class="text-truncate">${p.page?.page_name || 'Unnamed'}</strong>
                </div>
                <div class="text-muted small" style="font-size: 0.65rem;">${p.post_timestamp}</div>
              </div>
              <div class="mt-1 text-dark" style="display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;font-size: 0.8rem;">
                ${p.post_content || ''}
              </div>
              <div class="d-flex gap-2 text-muted align-items-center" style="font-size: 0.7rem;">
                ${Object.entries(p.reactions || {}).map(([reaction, count]) => {
                  const emoji = { '‡∏ñ‡∏π‡∏Å‡πÉ‡∏à':'üëç', '‡∏£‡∏±‡∏Å‡πÄ‡∏•‡∏¢':'‚ù§Ô∏è', '‡πÄ‡∏®‡∏£‡πâ‡∏≤':'üò¢', '‡πÇ‡∏Å‡∏£‡∏ò':'üò°', '‡∏ß‡πâ‡∏≤‡∏ß':'üòÆ', '‡∏Æ‡πà‡∏≤‡πÜ':'üòÇ', '‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢':'ü•∞' }[reaction] || '';
                  return `<span>${emoji} ${count}</span>`;
                }).join('')}
                <span>üí¨ ${p.comment_count || 0}</span>
                <span>‚Ü™ ${p.share_count || 0}</span>
                <span class="ms-auto fw-semibold text-dark">üî• ${p.total_engagement || 0}</span>
              </div>
            </div>
          </div>
        `).join('');

        document.getElementById('followersPostsModalBody').innerHTML = html;
        new bootstrap.Modal(document.getElementById('followersPostsModal')).show();
      }
    },
    animation: {
      onComplete: function () {
        const meta = followersChart.getDatasetMeta(0);
        const overlays = document.getElementById('chartOverlays');
        overlays.innerHTML = '';

        meta.data.forEach((bar, i) => {
          const x = bar.x;
          const y = bar.y;
          const page = chartData[i];
          if (!page || !page.profile_pic || !page.platform) return;

          const wrapper = document.createElement('div');
          wrapper.style.position = 'absolute';
          wrapper.style.left = (x - 18) + 'px';
          wrapper.style.top = (y - 44) + 'px';
          wrapper.style.width = '36px';
          wrapper.style.height = '36px';

          const img = document.createElement('img');
          img.src = page.profile_pic;
          img.style.width = '36px';
          img.style.height = '36px';
          img.style.borderRadius = '50%';
          img.style.border = '2px solid white';
          img.style.boxShadow = '0 1px 2px rgba(0,0,0,0.15)';
          wrapper.appendChild(img);

          const icon = document.createElement('img');
          if (page.platform === "facebook")
            icon.src = "{% static 'assets/img/icons/facebook-icon.webp' %}";
          else if (page.platform === "tiktok")
            icon.src = "{% static 'assets/img/icons/tiktoklogo.webp' %}";
          else if (page.platform === "instagram")
            icon.src = "{% static 'assets/img/icons/iglogo.png' %}";
          else if (page.platform === "lemon8")
            icon.src = "{% static 'assets/img/icons/lemon8logo.png' %}";
          else if (page.platform === "youtube")
            icon.src = "{% static 'assets/img/icons/youtubelogo.png' %}";

          icon.style.width = '14px';
          icon.style.height = '14px';
          icon.style.position = 'absolute';
          icon.style.bottom = '0';
          icon.style.right = '0';
          icon.style.borderRadius = '50%';
          icon.style.border = '1px solid white';
          icon.style.backgroundColor = 'white';
          wrapper.appendChild(icon);

          overlays.appendChild(wrapper);
        });
      }
    },
    scales: {
      x: {
        ticks: {
          color: '#2b2c40',
          font: { size: 11 },
          maxRotation: 0,
          minRotation: 0
        },
        grid: { display: false }
      },
      y: {
        beginAtZero: true,
        suggestedMax: Math.max(...data) * 1.2,
        ticks: {
          color: '#adb5bd',
          font: { size: 12 },
          callback: value => value.toLocaleString()
        },
        grid: {
          color: '#e9ecef',
          drawBorder: false
        }
      }
    }
  }
});
</script>




  <!-- üü° Share of Interaction -->
  <div class="col-md-6 d-flex">
    <div class="card shadow-sm border-0 p-4 w-100 d-flex flex-column">
      <div>
        <h6 class="mb-1 fw-semibold" style="font-size: 18px;">Share of Interaction</h6>
        <p class="text-muted" style="font-size: 14px;">Which profile got the most interactions on their posts?</p>
      </div>
      <div id="shareInteractionChart" style="width: 100%; height: 100%;"></div>
    </div>
  </div>
</div>

          <br>

<!-- üßä Modal: Posts by Selected Page -->
<div class="modal fade" id="interactionPostsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-semibold">Posts by Selected Page</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="interactionPostsContent">
        <!-- Injected Posts -->
      </div>
    </div>
  </div>
</div>

<!-- Google Charts API -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>
  google.charts.load("current", { packages: ["corechart"] });
  google.charts.setOnLoadCallback(drawShareInteractionChart);

  function drawShareInteractionChart() {
    const interactionData = JSON.parse(`{{ interaction_data_json|safe }}`);
    const postsMap = JSON.parse(`{{ followers_posts_map|escapejs }}`);
    const chartDiv = document.getElementById('shareInteractionChart');

    const dataArray = [['Page', 'Interactions', { role: 'tooltip', p: { html: true } }, { role: 'style' }]];
    interactionData.forEach((p, i) => {
      const tooltip = `<div style='padding:6px 8px'><b>${p.name}</b><br>${p.interactions} interactions</div>`;
      dataArray.push([p.name, p.interactions, tooltip, `color: ${p.color}`]);
    });

    const data = google.visualization.arrayToDataTable(dataArray);

    const options = {
      pieHole: 0.65,
      tooltip: { isHtml: true },
      legend: { position: 'labeled', textStyle: { fontSize: 13, color: '#333' } },
      pieSliceText: 'none',
      colors: interactionData.map(p => p.color),
      chartArea: { width: '85%', height: '90%' },
      fontName: 'Inter',
      animation: { duration: 500, easing: 'out' },
      backgroundColor: 'transparent'
    };

    const chart = new google.visualization.PieChart(chartDiv);
    chart.draw(data, options);

    // Click Event for Slice
    google.visualization.events.addListener(chart, 'select', () => {
      const selectedItem = chart.getSelection()[0];
      if (selectedItem) {
        const pageName = data.getValue(selectedItem.row, 0);
        const pageObj = interactionData.find(p => p.name === pageName);
        const pageId = pageObj ? pageObj.id || null : null;
        const posts = postsMap[pageId] || [];

        document.querySelector('#interactionPostsModal .modal-title').innerText = `Posts by ${pageName}`;

        const html = posts.map(p => `
          <div class="d-flex border rounded mb-2 small overflow-hidden" style="height: 90px;">
            <div style="width: 90px; height: 90px; flex-shrink: 0; overflow: hidden;">
              ${p.post_imgs?.[0] ? `<a href="https://www.facebook.com/${p.post_id}" target="_blank">
              <img src="${p.post_imgs[0]}" style="height: 100%; width: 90px; object-fit: cover;" class="rounded-start" /></a>` :
              `<div style="height: 100%; width: 90px; background-color: #f8f9fa;"></div>`}
            </div>
            <div class="flex-grow-1 px-2 py-1 d-flex flex-column justify-content-between" style="min-width: 0;">
              <div class="d-flex justify-content-between align-items-start">
                <div class="d-flex align-items-center gap-2">
                  ${p.page?.profile_pic ? `<img src="${p.page.profile_pic}" class="rounded-circle" style="width: 16px; height: 16px;">` : ''}
                  <i class="bi bi-facebook text-primary"></i>
                  <strong class="text-truncate">${p.page?.page_name || 'Unnamed'}</strong>
                </div>
                <div class="text-muted small" style="font-size: 0.65rem;">${p.post_timestamp}</div>
              </div>
              <div class="mt-1 text-dark" style="display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;font-size: 0.8rem;">
                ${p.post_content || ''}
              </div>
              <div class="d-flex gap-2 text-muted align-items-center" style="font-size: 0.7rem;">
                ${Object.entries(p.reactions || {}).map(([r, c]) => {
                  const emoji = { '‡∏ñ‡∏π‡∏Å‡πÉ‡∏à': 'üëç', '‡∏£‡∏±‡∏Å‡πÄ‡∏•‡∏¢': '‚ù§Ô∏è', '‡πÄ‡∏®‡∏£‡πâ‡∏≤': 'üò¢', '‡πÇ‡∏Å‡∏£‡∏ò': 'üò°', '‡∏ß‡πâ‡∏≤‡∏ß': 'üòÆ', '‡∏Æ‡πà‡∏≤‡πÜ': 'üòÇ', '‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢': 'ü•∞' }[r] || '';
                  return `<span>${emoji} ${c}</span>`;
                }).join('')}
                <span>üí¨ ${p.comment_count || 0}</span>
                <span>‚Ü™ ${p.share_count || 0}</span>
                <span class="ms-auto fw-semibold text-dark">üî• ${p.total_engagement || 0}</span>
              </div>
            </div>
          </div>
        `).join('');

        document.getElementById('interactionPostsContent').innerHTML = html;
        new bootstrap.Modal(document.getElementById('interactionPostsModal')).show();
      }
    });

    window.addEventListener('resize', drawShareInteractionChart);
  }
</script>


  <!-- üìä Number of posts by days & Best Times To Post -->
  <div class="row">
    <!-- üìä Number of posts by days -->
    <div class="col-md-6 d-flex">
      <div class="card shadow-sm border-0 p-4 w-100">
        <h6 class="mb-3">Number of posts by days</h6>
        <canvas id="postsByDayChart" style="width:100%; height:100%;"></canvas>
      </div>
    </div>
   <!-- üß† Popup Modal -->
  <div class="modal fade" id="popupModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title">Posts in Selected By Day</h6>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="popupContent"></div>
      </div>
    </div>
  </div>

    <script>
  document.addEventListener("DOMContentLoaded", function () {
    const postsByDayChart = new Chart(document.getElementById("postsByDayChart").getContext("2d"), {
      type: "bar",
      data: {
        labels: {{ bar_day_labels|safe }},
        datasets: [{
          label: "Number of posts",
          data: {{ bar_day_values|safe }},
          backgroundColor: {{ bar_day_colors|safe }},
          borderRadius: 6,
          barThickness: 28
        }]
      },
      options: {
        onClick: function (e, elements) {
          if (elements.length > 0) {
            const dayIndex = elements[0].index;
            const postsMap = JSON.parse('{{ posts_by_day_json|escapejs }}');
            const posts = postsMap[dayIndex] || [];

            document.querySelector('#popupModal .modal-title').innerText = 'Posts in Selected By Day';

            const html = posts.map(p => `
              <div class="d-flex border rounded mb-2 small overflow-hidden" style="height: 90px;">
                <div style="width: 90px; height: 90px; flex-shrink: 0; overflow: hidden;">
                  ${p.post_imgs?.[0] ? `<a href="https://www.facebook.com/${p.post_id}" target="_blank"><img src="${p.post_imgs[0]}" class="rounded-start" style="height: 100%; width: 90px; object-fit: cover;" /></a>` : `<div style="height: 100%; width: 90px; background-color: #f8f9fa;"></div>`}
                </div>
                <div class="flex-grow-1 px-2 py-1 d-flex flex-column justify-content-between" style="min-width: 0;">
                  <div class="d-flex justify-content-between align-items-start">
                    <div class="d-flex align-items-center gap-2">
                      ${p.profile_pic ? `<img src="${p.profile_pic}" class="rounded-circle" style="width: 16px; height: 16px;">` : ''}
                      <i class="bi bi-facebook text-primary"></i>
                      <strong class="text-truncate">${p.page_name}</strong>
                    </div>
                    <div class="text-muted small" style="font-size: 0.65rem;">${p.post_timestamp}</div>
                  </div>
                  <div class="mt-1 text-dark" style="display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;font-size: 0.8rem;">
                    ${p.post_content}
                  </div>
                  <div class="d-flex gap-2 text-muted align-items-center" style="font-size: 0.7rem;">
                    ${Object.entries(p.reactions || {}).map(([r, c]) => {
                      const emoji = { '‡∏ñ‡∏π‡∏Å‡πÉ‡∏à': 'üëç', '‡∏£‡∏±‡∏Å‡πÄ‡∏•‡∏¢': '‚ù§Ô∏è', '‡πÄ‡∏®‡∏£‡πâ‡∏≤': 'üò¢', '‡πÇ‡∏Å‡∏£‡∏ò': 'üò°', '‡∏ß‡πâ‡∏≤‡∏ß': 'üòÆ', '‡∏Æ‡πà‡∏≤‡πÜ': 'üòÇ', '‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢': 'ü•∞' }[r] || '';
                      return `<span>${emoji} ${c}</span>`;
                    }).join('')}
                    <span>üí¨ ${p.comment_count || 0}</span>
                    <span>‚Ü™ ${p.share_count || 0}</span>
                    <span class="ms-auto fw-semibold text-dark">üî• ${p.total_engagement}</span>
                  </div>
                </div>
              </div>
            `).join('');

            document.getElementById('popupContent').innerHTML = html;
            new bootstrap.Modal(document.getElementById('popupModal')).show();
          }
        },
        scales: {
          y: { beginAtZero: true, ticks: { precision: 0 } },
          x: { grid: { display: false } }
        },
        plugins: { legend: { display: false } }
      }
    });
  });
  </script>


  <!-- üïí Best Times To Post -->
    <div class="col-md-6 d-flex">
      <div class="card shadow-sm border-0 p-4 w-100">
        <h6 class="mb-3">Best Times To Post</h6>
        <canvas id="bestTimesChart" style="width:100%; height:100%;"></canvas>
      </div>
    </div>
  </div>

  <!-- üìä Popup Template -->
  <div class="modal fade" id="popupModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title">Posts in Selected Time Slot</h6>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="popupContent">
          <!-- Content Injected by JS -->
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    function getColorByPostCount(count) {
      const max = 30;
      const ratio = Math.min(count / max, 1);
      const hue = (1 - ratio) * 240; // 240 = ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô ‚Üí 0 = ‡πÅ‡∏î‡∏á
      return `hsl(${hue}, 70%, 60%)`;
    }

    const bubbles = JSON.parse('{{ bubble_data|escapejs }}');
    const postMap = JSON.parse('{{ posts_grouped_json|escapejs }}');

    const ctx = document.getElementById("bestTimesChart").getContext("2d");
    const chart = new Chart(ctx, {
      type: 'bubble',
      data: {
        datasets: bubbles.map(b => ({
          data: [{
            x: b.x, y: b.y, r: b.r,
            count: b.count,
            likes: b.likes,
            comments: b.comments,
            shares: b.shares,
            key: b.key,
            label: b.tooltip_label
          }],
          backgroundColor: getColorByPostCount(b.count),
          hoverBackgroundColor: getColorByPostCount(b.count)
        }))
      },
      options: {
        responsive: true,
        plugins: {
          tooltip: {
            callbacks: {
              label: ctx => [
                ctx.raw.label,
                `${ctx.raw.count} Number of posts`,
                `${ctx.raw.likes} Likes, ${ctx.raw.comments} Comments, ${ctx.raw.shares} Shares`
              ]
            }
          },
          legend: { display: false }
        },
        scales: {
          x: {
            min: -0.5, max: 6.5,
            ticks: { callback: v => ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'][v] }
          },
          y: { min: 0, max: 24, ticks: { stepSize: 2 } }
        },
        onClick: (e, elements) => {
          if (elements.length) {
            const key = chart.data.datasets[elements[0].datasetIndex].data[0].key;
            const posts = postMap[key] || [];

            document.querySelector('#popupModal .modal-title').innerText = 'Posts in Selected Time Slot';


            const html = posts.map(p => `
              <div class="d-flex border rounded mb-2 small overflow-hidden" style="height: 90px;">
                <div style="width: 90px; height: 90px; flex-shrink: 0; overflow: hidden;">
                  ${p.post_imgs?.[0] ? `<a href="https://www.facebook.com/${p.post_id}" target="_blank">
                    <img src="${p.post_imgs[0]}" style="height: 100%; width: 90px; object-fit: cover;" class="rounded-start" /></a>` :
                    `<div style="height: 100%; width: 90px; background-color: #f8f9fa;"></div>`}
                </div>
                <div class="flex-grow-1 px-2 py-1 d-flex flex-column justify-content-between" style="min-width: 0;">
                  <div class="d-flex justify-content-between align-items-start">
                    <div class="d-flex align-items-center gap-2">
                      ${p.page?.profile_pic ? `<img src="${p.page.profile_pic}" class="rounded-circle" style="width: 16px; height: 16px;">` : ''}
                      <i class="bi bi-facebook text-primary"></i>
                      <strong class="text-truncate">${p.page?.page_name || 'Unnamed'}</strong>
                    </div>
                    <div class="text-muted small" style="font-size: 0.65rem;">${p.post_timestamp}</div>
                  </div>
                  <div class="mt-1 text-dark" style="display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;text-overflow: ellipsis;font-size: 0.8rem;">
                    ${p.post_content || ''}
                  </div>
                  <div class="d-flex gap-2 text-muted align-items-center" style="font-size: 0.7rem;">
                    ${Object.entries(p.reactions || {}).map(([reaction, count]) => {
                      const emoji = { '‡∏ñ‡∏π‡∏Å‡πÉ‡∏à':'üëç', '‡∏£‡∏±‡∏Å‡πÄ‡∏•‡∏¢':'‚ù§Ô∏è', '‡πÄ‡∏®‡∏£‡πâ‡∏≤':'üò¢', '‡πÇ‡∏Å‡∏£‡∏ò':'üò°', '‡∏ß‡πâ‡∏≤‡∏ß':'üòÆ', '‡∏Æ‡πà‡∏≤‡πÜ':'üòÇ', '‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢':'ü•∞' }[reaction] || '';
                      return `<span>${emoji} ${count}</span>`;
                    }).join('')}
                    <span>üí¨ ${p.comment_count || 0}</span>
                    <span>‚Ü™ ${p.share_count || 0}</span>
                    <span class="ms-auto fw-semibold text-dark">üî• ${p.total_engagement || 0}</span>
                  </div>
                </div>
              </div>
            `).join('');

            document.getElementById('popupContent').innerHTML = html;
            new bootstrap.Modal(document.getElementById('popupModal')).show();
          }
        }
      }
    });
  });
  </script>

<br>
<!-- üìå Top 10 Posts: Engagement Section -->
<div class="card shadow-sm rounded mb-5" style="max-width: 100%; height: 550px; overflow-y: auto; position: relative;">
  <!-- ‚úÖ Sticky Header -->
  <div class="d-flex justify-content-between align-items-center"
       style="position: sticky; top: 0; z-index: 10; background: white; padding: 12px 16px; border-bottom: 1px solid #eee;">
    <h5 class="fw-bold mb-0" style="font-size: 16px;">Top 10 Posts: Engagement</h5>
    <button class="btn btn-light btn-sm border" onclick="openPresentation()">üìä Presentation</button>
  </div>

  <!-- ‚úÖ Grid Layout -->
  <div class="px-3 py-2">
    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-xl-6 g-3">
      {% for post in facebook_posts_top10 %}
      <div class="col">
        <a href="https://www.facebook.com/{{ post.post_id }}" target="_blank" class="text-decoration-none">
          <div class="position-relative rounded overflow-hidden shadow-sm" style="height: 250px;">
            <!-- üî∫ Background Image -->
            <img src="{{ post.post_imgs.0 }}" class="w-100 h-100" style="object-fit: cover;">

            <!-- üîµ Profile Picture + Facebook Icon -->
            <div class="position-absolute top-0 start-0 m-1">
              <div class="position-relative" style="width: 24px; height: 24px;">
                {% if post.page_profile_pic %}
                <img src="{{ post.page_profile_pic }}" class="rounded-circle border border-white"
                     width="24" height="24" style="object-fit: cover;">
                {% else %}
                <img src="{% static 'assets/img/icons/default_profile.png' %}" class="rounded-circle border border-white"
                     width="24" height="24" style="object-fit: cover;">
                {% endif %}
                <img src="{% static 'assets/img/icons/facebooklogo.png' %}"
                     width="10" height="10"
                     class="position-absolute bottom-0 end-0 bg-white rounded-circle border border-white">
              </div>
            </div>

            <!-- üìà Engagement Rate -->
            <div class="position-absolute top-0 end-0 m-1">
              <span class="bg-dark text-white small px-1 py-0 rounded" style="opacity: 0.85; font-size: 11px;">
                {{ post.engagement_rate }}%
              </span>
            </div>

            <!-- üïí Timestamp & Content -->
            <div class="position-absolute bottom-0 start-0 text-white text-shadow px-2 py-1"
                 style="font-size: 10px; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.6));">
              <div class="small mt-1">
                <span class="badge bg-light text-dark" style="font-size: 9px; opacity: 0.85;">
                  üìå {{ post.content_pillar }}
                   </span>
              </div>

              <div>{{ post.post_timestamp }}</div>
              <div class="fw-semibold text-truncate">{{ post.post_content }}</div>
            </div>

            <!-- üì∑ Post Type Icon -->
            <div class="position-absolute bottom-0 end-0 m-1">
              {% if post.post_type == "video" %}
              <i class="fas fa-play-circle text-white" style="font-size: 12px;"></i>
              {% else %}
              <i class="fas fa-image text-white" style="font-size: 12px;"></i>
              {% endif %}
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>
</div>


<!-- üìä Presentation Modal -->
<div id="presentationModal" class="modal fade" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content">

      <div class="modal-body p-4 d-flex justify-content-center align-items-center" style="height: 100vh;">
          <!-- üü¶ Left Title Section -->
  <div class="pe-5" style="min-width: 300px;">
    <h2 class="fw-bold mb-0" style="font-size: 26px;">Top 10 Posts: Engagement</h2>
  </div>

  <!-- üü® Right Cards Section -->
  <div class="flex-grow-1" style="max-width: 1100px;">
    <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-xl-5 g-3">
      {% for post in facebook_posts_top10 %}
      <div class="col">
        <a href="https://www.facebook.com/{{ post.post_id }}" target="_blank" class="text-decoration-none">
          <div class="position-relative rounded overflow-hidden shadow-sm" style="width: 100%; aspect-ratio: 4/5;">
            <!-- üî∫ Background Image -->
            <img src="{{ post.post_imgs.0 }}" class="w-100 h-100" style="object-fit: cover;">

            <!-- üîµ Profile Picture + Facebook Icon -->
            <div class="position-absolute top-0 start-0 m-2">
              <div class="position-relative" style="width: 24px; height: 24px;">
                {% if post.page_profile_pic %}
                  <img src="{{ post.page_profile_pic }}" class="rounded-circle border border-white w-100 h-100" style="object-fit: cover;">
                {% else %}
                  <img src="{% static 'assets/img/icons/default_profile.png' %}" class="rounded-circle border border-white w-100 h-100" style="object-fit: cover;">
                {% endif %}
                <img src="{% static 'assets/img/icons/facebooklogo.png' %}" width="10" height="10" class="position-absolute bottom-0 end-0 bg-white rounded-circle border border-white">
              </div>
            </div>

            <!-- üìà Engagement Rate -->
            <div class="position-absolute top-0 end-0 m-2">
              <span class="bg-dark text-white small px-2 py-1 rounded" style="opacity: 0.85;">{{ post.engagement_rate }}%</span>
            </div>

            <!-- üïí Timestamp & Content -->
            <div class="position-absolute bottom-0 start-0 text-white text-shadow p-2" style="font-size: 11px; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.55));">
              <div class="mt-1">
                <span class="badge bg-light text-dark" style="font-size: 10px; opacity: 0.85;">
                  üìå {{ post.content_pillar }}
                </span>
              </div>


              <div>{{ post.post_timestamp }}</div>
              <div class="fw-semibold text-truncate">{{ post.post_content }}</div>
            </div>

            <!-- üì∑ Post Type -->
            <div class="position-absolute bottom-0 end-0 m-2">
              {% if post.post_type == "video" %}
                <i class="fas fa-play-circle text-white"></i>
              {% else %}
                <i class="fas fa-image text-white"></i>
              {% endif %}
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

    </div>
  </div>
</div>

<script>
function openPresentation() {
  var modal = new bootstrap.Modal(document.getElementById('presentationModal'));
  modal.show();
}
</script>

  <br>

{% if pillar_summary %}
<!-- üìö Content Pillar Summary Table -->
<div class="card shadow-sm rounded p-4 mb-4 w-100" style="max-width: 700px; margin: auto;">
  <div class="card-body p-2">
    <h6 class="fw-semibold mb-3" style="font-size: 18px;">Content Pillar Summary</h6>
    <table class="table table-hover small mb-0">
      <thead class="table-light">
        <tr>
          <th style="width: 70%;">Content Pillar</th>
          <th class="text-end">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå</th>
        </tr>
      </thead>
      <tbody>
        {% for row in pillar_summary %}
          <tr style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#pillarModal-{{ row.content_pillar|slugify }}">
            <td>
              {% if row.content_pillar == "Realtime" %}üïí{% elif row.content_pillar == "Recipe" %}üìã{% elif row.content_pillar == "Promotion" %}üí∏
              {% elif row.content_pillar == "Product" %}üì¶{% elif row.content_pillar == "Activity" %}üéØ{% elif row.content_pillar == "CSR" %}üå±
              {% elif row.content_pillar == "PR and Event" %}üì¢{% elif row.content_pillar == "Knowledge" %}üìò{% elif row.content_pillar == "Lifestyle" %}üåü
              {% else %}üìÅ{% endif %}
              {{ row.content_pillar }}
            </td>
            <td class="text-end fw-bold">{{ row.post_count }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ü™ü MODALS -->
{% for row in pillar_summary %}
<div id="pillarModal-{{ row.content_pillar|slugify }}" class="modal fade" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content">
      <div class="modal-body p-4 d-flex justify-content-center align-items-center" style="height: 100vh; overflow: hidden;">
        <!-- Left Title -->
        <div class="pe-5" style="min-width: 300px;">
          <h2 class="fw-bold mb-1" style="font-size: 22px;">‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î</h2>
          <h2 class="fw-semibold text-muted" style="font-size: 26px;">
            {% if row.content_pillar == "Realtime" %}üïí{% elif row.content_pillar == "Recipe" %}üìã{% elif row.content_pillar == "Promotion" %}üí∏
            {% elif row.content_pillar == "Product" %}üì¶{% elif row.content_pillar == "Activity" %}üéØ{% elif row.content_pillar == "CSR" %}üå±
            {% elif row.content_pillar == "PR and Event" %}üì¢{% elif row.content_pillar == "Knowledge" %}üìò{% elif row.content_pillar == "Lifestyle" %}üåü
            {% else %}üìÅ{% endif %}
            "{{ row.content_pillar }}"
          </h2>
        </div>

        <!-- Right Posts -->
        <div class="flex-grow-1" style="max-height: 90vh; overflow-y: auto; overflow-x: hidden;">
          <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-xl-5 g-3">
            {% with found_posts=posts_by_pillar|dictsort:"pillar" %}
              {% for item in found_posts %}
                {% if item.pillar == row.content_pillar %}
                <div class="col">
                  <a href="https://www.facebook.com/{{ item.post.post_id }}" target="_blank" class="text-decoration-none">
                    <div class="position-relative rounded overflow-hidden shadow-sm" style="width: 100%; aspect-ratio: 4/5;">
                      <img src="{{ item.post.post_imgs.0 }}" class="w-100 h-100" style="object-fit: cover;">
                      <div class="position-absolute top-0 start-0 m-2">
                        <div class="position-relative" style="width: 24px; height: 24px;">
                          {% if item.post.page.profile_pic %}
                            <img src="{{ item.post.page.profile_pic }}" class="rounded-circle border border-white w-100 h-100" style="object-fit: cover;">
                          {% else %}
                            <img src="{% static 'assets/img/icons/default_profile.png' %}" class="rounded-circle border border-white w-100 h-100" style="object-fit: cover;">
                          {% endif %}
                          <img src="{% static 'assets/img/icons/facebooklogo.png' %}" width="10" height="10" class="position-absolute bottom-0 end-0 bg-white rounded-circle border border-white">
                        </div>
                      </div>
                      <div class="position-absolute bottom-0 start-0 text-white text-shadow p-2" style="font-size: 11px; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.55));">
                        <div class="mt-1">
                          <span class="badge bg-light text-dark" style="font-size: 10px; opacity: 0.85;">
                            üìå {{ item.pillar }}
                          </span>
                        </div>
                        <div>{{ item.post.post_timestamp_dt|date:"Y-m-d H:i" }}</div>
                        <div class="fw-semibold text-truncate">{{ item.post.post_content }}</div>
                      </div>
                      <div class="position-absolute bottom-0 end-0 m-2">
                        <i class="fas fa-image text-white"></i>
                      </div>
                    </div>
                  </a>
                </div>
                {% endif %}
              {% endfor %}
              {% if not found_posts|length %}
              <div class="text-muted ms-3">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ</div>
              {% endif %}
            {% endwith %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endfor %}

{% else %}
<!-- ‚úÖ Empty State ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏à‡πÄ‡∏•‡∏¢ -->
<div class="card shadow-sm rounded p-4 mb-4 w-100 text-center" style="max-width: 700px; margin: auto;">
  <div class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏à‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏à‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå</div>
</div>
{% endif %}







            <!-- Footer -->           <!-- Footer -->
<footer class="content-footer footer bg-footer-theme mt-auto py-4 border-top" style="color: #FF6801;">
  <div class="container-xxl d-flex flex-column flex-md-row align-items-center justify-content-between">
    <div class="text-muted mb-2 mb-md-0">
      ¬© <script>document.write(new Date().getFullYear());</script> Growfox Marketing Data Center. All rights reserved.
    </div>
    <div class="footer-links d-flex flex-wrap gap-3">
      <a href="/terms" class="footer-link" style="color: #FF6801 !important;">Terms</a>
      <a href="/privacy" class="footer-link" style="color: #FF6801 !important;">Privacy</a>
      <a href="/support" class="footer-link" style="color: #FF6801 !important;">F.A.Q.</a>
    </div>
  </div>
</footer>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->

    <!-- build:js assets/vendor/js/theme.js  -->

    <script src="{% static 'assets/vendor/libs/jquery/jquery.js' %}"></script>

    <script src="{% static 'assets/vendor/libs/popper/popper.js' %}"></script>
    <script src="{% static 'assets/vendor/js/bootstrap.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/node-waves/node-waves.js' %}"></script>

    <script src="{% static 'assets/vendor/libs/@algolia/autocomplete-js.js' %}"></script>

    <script src="{% static 'assets/vendor/libs/pickr/pickr.js' %}"></script>

    <script src="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js' %}"></script>

    <script src="{% static 'assets/vendor/libs/hammer/hammer.js' %}"></script>

    <script src="{% static 'assets/vendor/libs/i18n/i18n.js' %}"></script>

    <script src="{% static 'assets/vendor/js/menu.js' %}"></script>

    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="{% static 'assets/vendor/libs/moment/moment.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js' %}"></script>
    <script src="{% static 'assets/vendor/libs/apex-charts/apexcharts.js' %}"></script>

    <!-- Main JS -->

    <script src="{% static 'assets/js/main.js' %}"></script>

    <!-- Page JS -->
    <script src="{% static 'assets/js/app-academy-dashboard.js' %}"></script>
  </body>
</html>